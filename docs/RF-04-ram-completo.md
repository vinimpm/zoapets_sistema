# RF-04: M√≥dulo RAM - Registro de Administra√ß√£o de Medicamentos

## üìã Vis√£o Geral

O m√≥dulo RAM (Registro de Administra√ß√£o de Medicamentos) √© o cora√ß√£o da seguran√ßa medicamentosa hospitalar, automatizando todo o processo de prescri√ß√£o, agendamento e registro de administra√ß√£o de medicamentos durante interna√ß√µes.

## üéØ Objetivo

Garantir rastreabilidade completa da administra√ß√£o de medicamentos, desde a prescri√ß√£o m√©dica at√© a aplica√ß√£o pelo enfermeiro, com registros de quem administrou, quando e eventuais intercorr√™ncias, atendendo √†s normas do CFMV e LGPD.

## ‚úÖ Status de Implementa√ß√£o

**Backend:** ‚úÖ Completo
**Frontend:** üî® Parcial (painel b√°sico, precisa refinamento)
**Integra√ß√£o:** ‚è≥ Pendente (gera√ß√£o autom√°tica de administra√ß√µes)

---

## üè• Arquitetura RAM

### Fluxo Completo

```
Prescri√ß√£o Hospitalar (Veterin√°rio)
    ‚Üì
Sistema Gera Administra√ß√µes Autom√°ticas
    ‚Üì
Painel de Enfermagem (Doses Pendentes)
    ‚Üì
Enfermeiro Administra no Hor√°rio
    ‚Üì
Registro RAM (Quem, Quando, Observa√ß√µes)
    ‚Üì
Auditoria Completa (CFMV/LGPD)
```

### Entidades Relacionadas

- **Prescricao** (tipo: 'hospitalar')
- **PrescricaoItem** (medicamento + dose + frequ√™ncia)
- **Administracao** (registro de cada aplica√ß√£o)
- **Medicamento** (cat√°logo)
- **Internacao** (v√≠nculo ao paciente)

---

## üîß Funcionalidades Implementadas

### 1. Criar Prescri√ß√£o Hospitalar

**Ator:** Veterin√°rio, Administrador

**Descri√ß√£o:** Cria prescri√ß√£o vinculada a uma interna√ß√£o. Ao criar prescri√ß√£o tipo='hospitalar', o sistema DEVE gerar automaticamente os hor√°rios de administra√ß√£o baseados na frequ√™ncia.

**Endpoint:** `POST /prescricoes`

**Payload:**
```json
{
  "tipo": "hospitalar",
  "petId": "uuid",
  "internacaoId": "uuid",
  "veterinarioId": "uuid",
  "dataPrescricao": "2025-01-15T10:00:00Z",
  "dataValidade": "2025-01-18T10:00:00Z",
  "observacoes": "Monitorar sinais de melhora",
  "itens": [
    {
      "medicamentoId": "uuid",
      "dose": "10mg/kg",
      "viaAdministracao": "IV",
      "frequencia": "8/8h",
      "dataInicio": "2025-01-15T12:00:00Z",
      "dataFim": "2025-01-18T12:00:00Z",
      "observacoes": "Aplicar lentamente"
    }
  ]
}
```

**Regras de Neg√≥cio:**
- Prescri√ß√£o tipo='hospitalar' SEMPRE vinculada a interna√ß√£o
- Interna√ß√£o deve estar ativa (status: 'em_andamento')
- Para cada item, sistema deve gerar administra√ß√µes autom√°ticas
- Frequ√™ncia parseada (ex: "8/8h" = a cada 8 horas)
- Administra√ß√µes criadas entre dataInicio e dataFim

**Exemplo de C√°lculo:**
```
Medicamento: Amoxicilina
Frequ√™ncia: 8/8h
In√≠cio: 15/01/2025 12:00
Fim: 17/01/2025 12:00

Administra√ß√µes Geradas:
1. 15/01 12:00 (pendente)
2. 15/01 20:00 (pendente)
3. 16/01 04:00 (pendente)
4. 16/01 12:00 (pendente)
5. 16/01 20:00 (pendente)
6. 17/01 04:00 (pendente)
7. 17/01 12:00 (pendente)
```

---

### 2. Listar Administra√ß√µes (Painel de Enfermagem)

**Ator:** Enfermeiro, Veterin√°rio, Administrador

**Descri√ß√£o:** Lista todas as administra√ß√µes com filtros para o painel de enfermagem.

**Endpoint:** `GET /administracoes?status=pendente&internacaoId=uuid`

**Filtros Dispon√≠veis:**
- `status`: pendente, realizado, atrasado, nao_realizado
- `internacaoId`: Filtra por interna√ß√£o espec√≠fica
- `petId`: Filtra por pet
- `data`: Filtra por data espec√≠fica

**Resposta:**
```json
[
  {
    "id": "uuid",
    "prescricaoItem": {
      "id": "uuid",
      "dose": "10mg/kg",
      "viaAdministracao": "IV",
      "medicamento": {
        "id": "uuid",
        "nome": "Amoxicilina",
        "principioAtivo": "Amoxicilina triidratada"
      },
      "prescricao": {
        "id": "uuid",
        "pet": {
          "id": "uuid",
          "nome": "Rex",
          "especie": "Canina"
        },
        "internacao": {
          "id": "uuid",
          "leito": "L-12",
          "status": "em_andamento"
        }
      }
    },
    "dataHoraPrevista": "2025-01-15T12:00:00Z",
    "dataHoraRealizada": null,
    "status": "pendente",
    "responsavel": null,
    "observacoes": null
  }
]
```

---

### 3. Buscar Administra√ß√µes Pendentes

**Ator:** Enfermeiro

**Descri√ß√£o:** Retorna todas as administra√ß√µes pendentes, ordenadas por hor√°rio previsto.

**Endpoint:** `GET /administracoes/pendentes`

**Resposta:** Array de administra√ß√µes com status='pendente'

---

### 4. Buscar Administra√ß√µes Atrasadas

**Ator:** Enfermeiro, Coordenador de Enfermagem

**Descri√ß√£o:** Retorna administra√ß√µes pendentes com hor√°rio previsto j√° passado (atrasadas).

**Endpoint:** `GET /administracoes/atrasadas`

**L√≥gica:**
```sql
WHERE status = 'pendente'
  AND dataHoraPrevista < NOW()
ORDER BY dataHoraPrevista ASC
```

**Uso:** Alertas de doses atrasadas no painel de enfermagem.

---

### 5. Buscar Pr√≥ximas Administra√ß√µes

**Ator:** Enfermeiro

**Descri√ß√£o:** Retorna administra√ß√µes pendentes nas pr√≥ximas N horas (padr√£o: 2h).

**Endpoint:** `GET /administracoes/proximas?horas=2`

**Par√¢metros:**
- `horas` (opcional): Janela de tempo (padr√£o: 2)

**L√≥gica:**
```sql
WHERE status = 'pendente'
  AND dataHoraPrevista BETWEEN NOW() AND NOW() + INTERVAL '2 hours'
ORDER BY dataHoraPrevista ASC
```

**Uso:** Prepara√ß√£o antecipada de medicamentos.

---

### 6. Registrar Administra√ß√£o

**Ator:** Enfermeiro

**Descri√ß√£o:** Registra que uma administra√ß√£o foi realizada.

**Endpoint:** `PATCH /administracoes/:id/registrar`

**Payload:**
```json
{
  "responsavelId": "uuid",
  "dataHoraRealizada": "2025-01-15T12:05:00Z",
  "observacoes": "Aplicado sem intercorr√™ncias. Pet tolerou bem."
}
```

**Regras de Neg√≥cio:**
- Status muda para 'realizado'
- Registra enfermeiro respons√°vel
- Hor√°rio real pode diferir do previsto
- Se atraso > 30min, gerar alerta autom√°tico
- Observa√ß√µes obrigat√≥rias se tiver intercorr√™ncia

**Auditoria:**
- Cria log: "Enfermeiro X administrou medicamento Y ao pet Z"
- Registra IP, timestamp, user_agent

---

### 7. Marcar Administra√ß√£o como N√£o Realizada

**Ator:** Enfermeiro, Coordenador de Enfermagem

**Descri√ß√£o:** Marca administra√ß√£o como n√£o realizada (ex: pet vomitou, recusou).

**Endpoint:** `PATCH /administracoes/:id/nao-realizar`

**Payload:**
```json
{
  "responsavelId": "uuid",
  "motivoNaoRealizado": "Pet apresentou v√¥mito logo antes da administra√ß√£o",
  "observacoes": "Veterin√°rio notificado. Aguardando nova conduta."
}
```

**Regras de Neg√≥cio:**
- Status muda para 'nao_realizado'
- Motivo √© OBRIGAT√ìRIO
- Veterin√°rio deve ser notificado (sistema ou manualmente)
- Gera alerta para revis√£o da prescri√ß√£o

---

### 8. Buscar Administra√ß√µes de uma Interna√ß√£o

**Ator:** Veterin√°rio, Enfermeiro

**Descri√ß√£o:** Lista todas as administra√ß√µes de uma interna√ß√£o espec√≠fica.

**Endpoint:** `GET /administracoes/internacao/:internacaoId`

**Resposta:** Array completo do hist√≥rico medicamentoso

**Uso:**
- Hist√≥rico medicamentoso do paciente
- Verificar ader√™ncia ao tratamento
- Auditoria cl√≠nica

---

### 9. Buscar Detalhes de Administra√ß√£o

**Ator:** Veterin√°rio, Enfermeiro, Auditor

**Descri√ß√£o:** Retorna detalhes completos de uma administra√ß√£o espec√≠fica.

**Endpoint:** `GET /administracoes/:id`

**Resposta:**
```json
{
  "id": "uuid",
  "prescricaoItem": {
    "medicamento": { ... },
    "dose": "10mg/kg",
    "viaAdministracao": "IV",
    "prescricao": {
      "veterinario": { ... },
      "pet": { ... },
      "internacao": { ... }
    }
  },
  "dataHoraPrevista": "2025-01-15T12:00:00Z",
  "dataHoraRealizada": "2025-01-15T12:05:00Z",
  "status": "realizado",
  "responsavel": {
    "id": "uuid",
    "nome": "Maria Enfermeira",
    "coren": "123456-SP"
  },
  "observacoes": "Aplicado sem intercorr√™ncias",
  "createdAt": "2025-01-15T10:00:00Z"
}
```

---

### 10. Painel de Enfermagem Consolidado

**Ator:** Enfermeiro

**Descri√ß√£o:** Endpoint consolidado que retorna todas as informa√ß√µes necess√°rias para o painel de enfermagem.

**Endpoint:** `GET /administracoes/painel-enfermagem`

**Resposta:**
```json
{
  "atrasadas": [
    {
      "internacao": { ... },
      "pet": { ... },
      "administracoes": [ ... ]
    }
  ],
  "pendentes": [
    {
      "internacao": { ... },
      "pet": { ... },
      "administracoes": [ ... ]
    }
  ],
  "proximas": [
    {
      "internacao": { ... },
      "pet": { ... },
      "administracoes": [ ... ]
    }
  ],
  "estatisticas": {
    "totalAtrasadas": 3,
    "totalPendentes": 15,
    "totalProximas": 8,
    "totalRealizadasHoje": 42
  }
}
```

**Uso:** Tela principal de enfermagem (/ram)

---

## üìä Regras de Neg√≥cio Completas

### RN-001: Tipos de Prescri√ß√£o
- **Ambulatorial:** Receita para casa, tutor administra, N√ÉO gera RAM
- **Hospitalar:** Pet internado, enfermeiro administra, GERA RAM autom√°tico

### RN-002: Gera√ß√£o Autom√°tica de Administra√ß√µes
- Ao criar prescri√ß√£o tipo='hospitalar', sistema DEVE criar administra√ß√µes
- Frequ√™ncias suportadas: 6/6h, 8/8h, 12/12h, 24/24h, 48/48h
- Hor√°rio inicial = dataInicio do item
- Hor√°rio final = dataFim do item
- Todas criadas com status='pendente'

### RN-003: Status de Administra√ß√£o
- **pendente:** Aguardando aplica√ß√£o
- **realizado:** Aplicado com sucesso
- **atrasado:** Autom√°tico se pendente + hor√°rio passado
- **nao_realizado:** Marcado manualmente com justificativa

### RN-004: Alertas de Atraso
- Se atraso > 30 minutos: Alerta amarelo
- Se atraso > 60 minutos: Alerta vermelho + notificar veterin√°rio
- Se atraso > 2 horas: Alerta cr√≠tico + registrar ocorr√™ncia

### RN-005: Permiss√µes
- **Prescrever:** Apenas Veterin√°rio
- **Administrar:** Enfermeiro, Veterin√°rio
- **Visualizar:** Todos os perfis cl√≠nicos
- **Auditar:** Administrador, Gerente

### RN-006: Auditoria (LGPD/CFMV)
- TODA administra√ß√£o gera log de auditoria
- Logs incluem: quem, quando, onde (IP), dispositivo
- Logs s√£o imut√°veis (append-only)
- Reten√ß√£o: 5 anos (CFMV) ou 10 anos (medicamentos controlados)

### RN-007: Medicamentos Controlados
- Portaria 344/98 ANVISA
- Registro especial com: lote, validade, receitu√°rio
- Dupla checagem obrigat√≥ria
- Relat√≥rio trimestral para ANVISA

---

## üîê Seguran√ßa e Compliance

### CFMV (Conselho Federal de Medicina Veterin√°ria)
- ‚úÖ Registro de quem prescreveu
- ‚úÖ Registro de quem administrou
- ‚úÖ Data/hora de cada a√ß√£o
- ‚úÖ Dose e via de administra√ß√£o
- ‚úÖ Rastreabilidade completa

### LGPD
- ‚úÖ Logs de acesso ao prontu√°rio
- ‚úÖ Consentimento do tutor (termo)
- ‚úÖ Direito ao esquecimento (soft delete)
- ‚úÖ Portabilidade de dados

### ANVISA (Medicamentos Controlados)
- ‚úÖ Rastreabilidade de lote
- ‚úÖ Controle de validade
- ‚úÖ Registro de dispensa√ß√£o
- ‚úÖ Relat√≥rios trimestrais

---

## üé® UX - Painel de Enfermagem

### Layout Proposto

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üè• Painel de Enfermagem - RAM                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ üî¥ ATRASADAS (3)                                    ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ ‚îÇ Rex (L-12) - Amoxicilina 10mg/kg IV      ‚îÇ       ‚îÇ
‚îÇ ‚îÇ ‚è∞ Previsto: 10:00  Atraso: 2h15min      ‚îÇ       ‚îÇ
‚îÇ ‚îÇ [REGISTRAR AGORA]                        ‚îÇ       ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ üü° PENDENTES (15)                                   ‚îÇ
‚îÇ [Filtrar: Todos | Por Leito | Por Pet]             ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ ‚îÇ Mia (L-08) - Dipirona 25mg/kg SC         ‚îÇ       ‚îÇ
‚îÇ ‚îÇ ‚è∞ Previsto: 14:00                       ‚îÇ       ‚îÇ
‚îÇ ‚îÇ [REGISTRAR]                              ‚îÇ       ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚è∞ PR√ìXIMAS 2H (8)                                  ‚îÇ
‚îÇ [Preparar Medica√ß√£o]                                ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ üìä ESTAT√çSTICAS DO DIA                              ‚îÇ
‚îÇ Realizadas: 42 | Pendentes: 15 | Atrasadas: 3     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ Casos de Uso

### UC-001: Prescrever Medicamento Hospitalar
1. Veterin√°rio acessa interna√ß√£o
2. Clica "Nova Prescri√ß√£o"
3. Seleciona medicamento, dose, frequ√™ncia
4. Define data in√≠cio/fim
5. Salva
6. **Sistema gera administra√ß√µes automaticamente**
7. Enfermeiro v√™ no painel

### UC-002: Administrar Medicamento
1. Enfermeiro abre painel RAM
2. V√™ doses pendentes
3. Prepara medicamento
4. Administra no pet
5. Registra no sistema (quem, quando)
6. Sistema atualiza status

### UC-003: Justificar N√£o Administra√ß√£o
1. Enfermeiro tenta administrar
2. Pet recusa ou apresenta rea√ß√£o
3. Marca como "N√£o Realizado"
4. Descreve motivo detalhadamente
5. Sistema notifica veterin√°rio
6. Veterin√°rio ajusta prescri√ß√£o

---

## üìà M√©tricas e Indicadores

### KPIs Sugeridos
- **Taxa de Ader√™ncia:** % de administra√ß√µes realizadas no hor√°rio
- **Tempo M√©dio de Atraso:** Diferen√ßa entre previsto e realizado
- **Taxa de N√£o Realiza√ß√£o:** % marcadas como n√£o realizadas
- **Administra√ß√µes por Turno:** Distribui√ß√£o da carga de trabalho

### Relat√≥rios
- Hist√≥rico medicamentoso por pet
- Consumo de medicamentos por interna√ß√£o
- Produtividade por enfermeiro
- Intercorr√™ncias e eventos adversos

---

## üîÑ Integra√ß√µes

### Com Outros M√≥dulos

**Interna√ß√µes (RF-05):**
- Prescri√ß√£o vinculada a interna√ß√£o ativa
- Ao dar alta, suspender prescri√ß√µes ativas

**Farm√°cia (RF-07):**
- Baixa autom√°tica de estoque ao administrar
- Controle de lote e validade
- Alertas de estoque baixo

**Auditoria (RF-09):**
- Todos os eventos geram logs
- Relat√≥rios para CFMV/ANVISA

**Financeiro (RF-13):**
- Medicamentos administrados ‚Üí contas
- Faturamento por conv√™nio

---

## üìù Pend√™ncias de Implementa√ß√£o

### Backend
- [x] Entity Administracao
- [x] Entity Prescricao
- [x] Entity PrescricaoItem
- [x] Service AdministracoesService
- [x] Controller com endpoints
- [ ] **L√≥gica gerar administra√ß√µes autom√°ticas** (CR√çTICO)
- [ ] **Endpoint painel-enfermagem consolidado**
- [ ] Notifica√ß√µes de atraso
- [ ] Relat√≥rios

### Frontend
- [x] P√°gina /ram b√°sica
- [ ] **Refatorar painel de enfermagem** (CR√çTICO)
- [ ] Cards de atrasadas/pendentes/pr√≥ximas
- [ ] Dialog registrar administra√ß√£o
- [ ] Filtros por leito/pet
- [ ] Alertas visuais e sonoros

---

## üìö Refer√™ncias

- **CFMV:** Resolu√ß√£o n¬∫ 1.321/2020 (Prontu√°rio Eletr√¥nico)
- **ANVISA:** Portaria 344/98 (Medicamentos Controlados)
- **LGPD:** Lei 13.709/2018

---

**Vers√£o:** 1.0
**Data:** 2025-10-21
**Autor:** Equipe T√©cnica Zoa Pets
**Status:** ‚úÖ Documenta√ß√£o Completa
